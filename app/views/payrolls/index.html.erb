<p id="notice"><%= notice %></p>

<h1>Payroll</h1>
<h3>Normal time hours: 160</h3>
<h3>Dates: <%= 2.months.ago.strftime("%a, %d %b %Y") %> to <%= 1.months.ago.strftime("%a, %d %b %Y") %></h3>

<ol class="list-group">
  <% @employee_details.each do |key, emp| %>
    <% employee = Employee.find_by(id: key) %>
    <li class="list-group-item">
      <div class="row">
        <div class="d-flex w-100 justify-content-between">
          <h4 class="mb-1"><%= employee.first_name %> <%= employee.last_name %></h4>
          <small class="text-muted"><%= employee.occupation %></small>
        </div>

      </div>


      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th colspan="3">Normal Time</th>
            <th colspan="3">Overtime</th>
            <th colspan="3">Sunday time</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Hours:</td>
            <td>Rate:</td>
            <td>Subtotal:</td>
            <td>Hours:</td>
            <td>Rate:</td>
            <td>Subtotal:</td>
            <td>Hours:</td>
            <td>Rate:</td>
            <td>Subtotal:</td>
          </tr>
          <% if emp[:normal_time] > 160.0 %>
            <% overtime = emp[:normal_time] - 160.0 %>
            <% emp[:normal_time] = emp[:normal_time] - overtime %>
          <% else %>
            <% overtime = 0 %>
          <% end %>
          <% rate = employee.net_rate %>
          <tr>
            <td><%= emp[:normal_time] %></td>
            <td><%= number_to_currency(rate, unit: "R") %></td>
            <td><%= number_to_currency(emp[:normal_time] * rate, unit: "R") %></td>
            <td><%= overtime %></td>
            <td><%= number_to_currency(rate * 1.5, unit: "R") %></td>
            <td><%= number_to_currency(rate * 1.5 * overtime, unit: "R") %></td>
            <td><%= emp[:sunday_time] %></td>
            <td><%= number_to_currency(rate * 2.0, unit: "R") %></td>
            <td><%= number_to_currency(rate * 2.0 * emp[:sunday_time], unit: "R") %></td>
          </tr>
        </tbody>
      </table>

      <div class="row">
        <div class="col-md-3">
          <h4> Net Total: </h4>
        </div>
        <div class="col-md-3">
          <% net_total = emp[:normal_time] * rate + rate * 1.5 * overtime + rate * 2.0 * emp[:sunday_time] %>
          <h4> <%= number_to_currency(net_total, unit: "R") %> </h4>
        </div>
        <div class="col-md-3">
          <h4> Gross Total: </h4>
        </div>
        <div class="col-md-3">
          <h4><%= number_to_currency(net_total*1.115, unit: "R") %></h4>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <small> SDL @ 2%: <%= number_to_currency(net_total * 0.02, unit: "R") %></small>
        </div>
        <div class="col-md-3">
          <small> UIF @ 1%: <%= number_to_currency(net_total * 0.01, unit: "R") %></small>
        </div>
        <div class="col-md-3">
          <small> COMM. @ 2.5%: <%= number_to_currency(net_total * 0.025, unit: "R") %></small>
        </div>
        <div class="col-md-3">
          <small> Leave @ 6%: <%= number_to_currency(net_total * 0.06, unit: "R") %></small>
        </div>
      </div>
    </li>
  <% end %>
</ol>

<br>
